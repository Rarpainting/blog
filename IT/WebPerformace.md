# Web 性能

## TCP

### TCP 调优

1. 增大 TCP 的初始拥塞窗口

  - 应对突发性的短暂连接

2. 慢启动重启

  - 在连接空闲是 **禁用慢启动** 可以改善瞬间发送数据的长 TCP 连接的性能

3. 窗口缩放(RFC 1323)

  - 增大最大接受窗口大小, 让 **高延迟** 的连接达到更好的吞吐量

4. TCP 快速打开(TFO -- TCP Fast Open)

  - 允许在第一个 SYN 分组中发送应用程序数据
  - 需要客户端和服务端共同支持
  
## HTTPS

### HTTPS 调优

- 把 TLS 库升级到最新版本, 在此基础上构建服务器
- 启动并配置 **会话缓存** 和 **无状态恢复**
- **监控** 会话缓存的使用情况并作出相应调整
- 在接近用户的地方完成 TLS 会话, 尽量减少往返延迟
- 配置 TLS 记录大小, 使其恰好能封装在一个 TCP 段内
- 确保 证书链 不会超过 拥塞窗口的对象
- 从 信任链 中去掉不必要的证书, 减少联调层次
- **禁用** 服务器的 TLS 压缩功能
- 启用服务器对 SNI(服务器名称指示) 的支持
- 启用服务器的 OCSP(在线证书状态协议 -- 实时检查证书状态的机制) 封装功能
- 追加 HTTP 严格参数安全首部(HSTS)
- **myssl**

## HTTP

示例: 谷歌搜索对 TTFB 的优化

在接到搜索后, 服务器立即向浏览器发送搜索页面的静态头部(或页眉)
然后在客户端解析头部的同时, 服务器开始搜索索引, 完成后, 再发送包含搜索结果的文档到客户端, 通过 JS 将动态信息写进 DOM 点

### HTTP 调优

#### 常规优化
- 减少 DNS 查询
- 减少 HTTP 请求
- 使用 CDN
- 添加 Expires 首部, 配置 ETag 标签
- Gzip 压缩资源
- 避免 HTTP 重定向

#### 进一步
- 使用 HTTP 持久连接(keep-alive)
- HTTP 管道 -- 把 FIFO 队列从客户端(请求队列)迁移到服务端(响应队列)
- 多个 TCP 连接
- 域名分区
- 控制协议开销
- 连接和拼接
- 嵌入资源(data:[mediatype][lbase64],data)

#### Performace

### HTTP 2.0
